# 開発計画（機能単位）

## フェーズ1: 基盤構築
- [x] **プロジェクトセットアップ**
  - Cargo.toml作成、依存関係定義
  - 基本的なディレクトリ構造

- [x] **データモデル定義**
  - `names.json`のserde構造体
  - schema_version、generated_at、entries管理

- [x] **データアクセス層**
  - XDGディレクトリ対応のパス解決
  - JSONファイル読み込み、HashMap変換

## フェーズ2: コア機能
- [x] **基本検索機能**
  - 完全一致検索（O(1)）
  - 英名の標準出力

- [x] **インタラクティブ選択**
  - skim統合
  - インクリメンタル検索
  - Emacsキーバインド対応

- [x] **CLIインターフェース**
  - clap設定
  - コマンド引数処理
  - ヘルプ表示

## フェーズ3: 更新機能
- [x] **基本更新機能**
  - HTTPSダウンロード（reqwest）
  - デフォルトURL管理

- [x] **セキュリティ機能**
  - SHA256検証
  - schema_version/countチェック

## フェーズ4: 配布準備
- [x] **CI/CD設定（Phase 1: 基盤構築）**
  - GitHub Actions月次データ更新ワークフロー作成
  - サンプルnames.json生成スクリプト
  - SHA256ハッシュ計算とGitHub Release自動作成
  - poke-lookup updateコマンドの動作確認

- [ ] **CI/CD設定（Phase 2: 実データ統合）**
  - [x] **データ取得スクリプト作成**（.github/scripts/fetch-pokemon-data.py）
    - PokéAPIから全ポケモン種数を動的取得（1025件）
    - 各ポケモンから ja-Hrkt と en の名前ペアを抽出
    - names.json 形式で出力（SHA256ハッシュ付き）
  - [x] **GitHub Actionsワークフロー更新**（update-data.yml）
    - サンプルデータ生成をスクリプト実行に置換
    - timeout延長（10分）とログ出力改善
  - [x] **データ品質・エラーハンドリング強化**
    - リトライ機能追加（3回まで自動リトライ）
    - エラー処理の改善（1件でも失敗したらexit code 1）

- [-] **バイナリ配布（スキップ）**
  - 動作確認できない環境への配布は無責任
  - cargo install で十分

- [x] **初回セットアップ改善**
  - README に初回セットアップ手順を明記
  - エラーメッセージは既に適切

- [x] **ドキュメント**
  - README作成（完了）
  - インストール・使用方法（cargo install 推奨）
  - 他ツールとの連携例（PokéAPI、Pokemiro）

## フェーズ5: 拡張機能
- [ ] **スプライト表示機能（ハイブリッドキャッシュ方式）**
  - [x] **基盤構築**
    - [x] Cargo.tomlに依存関係追加（viuer, reqwest, image）
    - [x] スプライト機能のフィーチャーフラグ設定
  - [x] **スプライトモジュール実装**
    - [x] SpriteServiceの作成（キャッシュ管理）
    - [x] ポケモンID マッピング機能
    - [x] キャッシュディレクトリ管理（~/.local/share/poke-lookup/sprites/）
  - [x] **画像取得機能**
    - [x] ハイブリッド取得（キャッシュ優先、なければダウンロード）
    - [x] PokéAPI sprites リポジトリからの取得
    - [x] エラーハンドリング（ネットワーク障害時の処理）
  - [x] **ターミナル対応**
    - [x] viuerを使用した画像表示
    - [x] ターミナル能力検出（viuerの自動検出に委譲）
    - [x] 非対応ターミナル向けフォールバック
  - [x] **CLI統合**
    - [x] --show-sprite / -s フラグ追加
    - [x] SearchServiceのget_pokemon_id()メソッド実装
    - [x] 効率的なスプライト表示統合（二重データロード解消）
    - [x] フィーチャーフラグによる適切な条件分岐
    - [x] エラー時の静かな失敗（英名は常に出力）
  - [x] **インタラクティブ選択統合**
    - [x] 選択確定後（Enter押下時）のスプライト表示
    - [x] エラー時の静かな失敗（英名は常に出力）
  - [x] **アーキテクチャリファクタリング**
    - [x] SearchServiceからsprite依存関係を分離
    - [x] SpriteServiceを自己完結型に変更（独自のID解決機能）
    - [x] 条件コンパイル問題の解決（dead_code警告対応）
    - [x] CI設定更新（default/all-features両方のテスト）
  - [ ] **ドキュメント更新**
    - [ ] README.mdにスプライト機能説明追加
    - [ ] 対応ターミナル一覧の記載
